<!DOCTYPE html>
<html lang="pt-BR">
<head>
<!-- no-manus-badge -->
<style>
/* Bloqueia o badge "Made with Manus" */
[data-manus],[id*="manus-badge"],[id*="manus-widget"],[class*="manus-badge"],[class*="manus-widget"],[class*="manus-branding"],a[href*="manus.im"],a[href*="manus.space"]{display:none!important;visibility:hidden!important;opacity:0!important;pointer-events:none!important;width:0!important;height:0!important;overflow:hidden!important;position:absolute!important;left:-9999px!important;}
</style>
<script>
/* Bloqueia o badge "Made with Manus" */
(function(){var s=['[data-manus]','[id*="manus-badge"]','[id*="manus-widget"]','[class*="manus-badge"]','[class*="manus-widget"]','[class*="manus-branding"]','a[href*="manus.im"]','a[href*="manus.space"]'];function r(){s.forEach(function(q){try{document.querySelectorAll(q).forEach(function(e){e.remove()});}catch(e){}});document.querySelectorAll('*').forEach(function(e){try{if(!e.children.length&&e.textContent&&e.textContent.trim().toLowerCase().includes('made with manus')){var p=e.closest('[style*="position: fixed"],[style*="position:fixed"],[style*="z-index"]')||e.parentElement;if(p&&p!==document.body)p.remove();else e.remove();}}catch(e){}});}if(window.MutationObserver){var o=new MutationObserver(function(m){m.forEach(function(x){if(x.addedNodes.length)r();});});o.observe(document.documentElement,{childList:true,subtree:true});}var c=0,i=setInterval(function(){r();if(++c>=20)clearInterval(i);},500);if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',r);}else{r();}window.addEventListener('load',function(){setTimeout(r,200);setTimeout(r,1000);setTimeout(r,3000);});})();
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Site - Painel de Monitoramento</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .back-button {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .site-info h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .site-url {
            color: #667eea;
            font-size: 14px;
            text-decoration: none;
        }

        .site-url:hover {
            text-decoration: underline;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .status-badge.online {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.offline {
            background: #fee2e2;
            color: #7f1d1d;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .metric-label {
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .metric-unit {
            font-size: 14px;
            color: #999;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .timeline {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .timeline-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .timeline-item {
            padding: 16px;
            border-left: 4px solid #ef4444;
            background: #fef2f2;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .timeline-item.recovery {
            border-left-color: #10b981;
            background: #d1fae5;
        }

        .timeline-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .timeline-description {
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="back-button" onclick="window.location.href='https://sistemas.administradoramutual.com.br/'">
                <i data-lucide="home" style="width: 16px; height: 16px;"></i>
                Portal de Sistemas
            </button>
            <button class="back-button" onclick="window.location.href='index.html'">
                <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i>
                Voltar ao Painel
            </button>
        </div>

        <header>
            <div class="site-header">
                <div class="site-info">
                    <h1 id="site-name">Carregando...</h1>
                    <a href="#" id="site-url" class="site-url" target="_blank">-</a>
                </div>
                <div id="site-status" class="status-badge">Verificando...</div>
            </div>
        </header>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Uptime 24h</div>
                <div class="metric-value" id="uptime-24h">--<span class="metric-unit">%</span></div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Uptime 7 dias</div>
                <div class="metric-value" id="uptime-7d">--<span class="metric-unit">%</span></div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Tempo Médio de Resposta</div>
                <div class="metric-value" id="avg-response">--<span class="metric-unit">ms</span></div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total de Incidentes</div>
                <div class="metric-value" id="total-incidents">--</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title"><i data-lucide="activity" style="display: inline-block; width: 18px; height: 18px; vertical-align: middle; margin-right: 8px;"></i>Tempo de Resposta (24h)</div>
                <canvas id="responseChart"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title"><i data-lucide="bar-chart-2" style="display: inline-block; width: 18px; height: 18px; vertical-align: middle; margin-right: 8px;"></i>Incidentes por Dia (7 dias)</div>
                <canvas id="incidentsChart"></canvas>
            </div>
        </div>

        <div class="timeline">
            <div class="timeline-title"><i data-lucide="clock" style="display: inline-block; width: 18px; height: 18px; vertical-align: middle; margin-right: 8px;"></i>Timeline de Incidentes</div>
            <div id="timeline-container"></div>
        </div>

        <footer>
            <p>© 2025 Administradora Mutual. Todos os direitos reservados.</p>
        </footer>
    </div>

    <script>
        // Obter parâmetros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const siteUrl = urlParams.get('url');

        if (!siteUrl) {
            window.location.href = 'index.html';
        }

        // Carregar dados do localStorage
        const monitoringHistory = JSON.parse(localStorage.getItem('monitoringHistory') || '{}');
        const siteHistory = monitoringHistory[siteUrl] || [];

        // Encontrar informações do site
        const sites = [
            { name: 'Movimento Mais Brasil', url: 'https://www.movimentomaisbrasil.org.br' },
            { name: 'Movimento Mais Seguro', url: 'https://www.movimentomaisseguro.com.br' },
            { name: 'Mais Brasil Motorcycle', url: 'https://www.maisbrasilmotorcycle.com.br' },
            { name: 'Potere BP Mensal', url: 'https://www.poterebpmensal.com.br' },
            { name: 'Potere Consórcio', url: 'https://www.potereconsorcio.com.br' },
            { name: 'Potere Seguro Auto', url: 'https://www.potereseguroauto.com.br' },
            { name: 'Soluções Corretora', url: 'https://www.solucoescorretora.com.br' },
            { name: 'Alpha Proteções', url: 'https://www.alphaprotecoes.com.br' },
            { name: 'Grupo MMB', url: 'https://www.grupommb.com' },
            { name: 'Juntos Podemos Mais', url: 'https://www.juntospodmais.com.br' }
        ];

        const site = sites.find(s => s.url === siteUrl);

        if (!site) {
            window.location.href = 'index.html';
        }

        // Atualizar cabeçalho
        document.getElementById('site-name').textContent = site.name;
        document.getElementById('site-url').textContent = site.url;
        document.getElementById('site-url').href = site.url;

        // Calcular métricas
        function calculateMetrics() {
            if (siteHistory.length === 0) {
                return {
                    uptime24h: 0,
                    uptime7d: 0,
                    avgResponse: 0,
                    totalIncidents: 0,
                    currentStatus: 'checking'
                };
            }

            const now = Date.now();
            const day24 = now - (24 * 60 * 60 * 1000);
            const day7 = now - (7 * 24 * 60 * 60 * 1000);

            const last24h = siteHistory.filter(h => new Date(h.timestamp).getTime() > day24);
            const last7d = siteHistory.filter(h => new Date(h.timestamp).getTime() > day7);

            const uptime24h = last24h.length > 0 
                ? (last24h.filter(h => h.status === 'online').length / last24h.length * 100).toFixed(2)
                : 0;

            const uptime7d = last7d.length > 0 
                ? (last7d.filter(h => h.status === 'online').length / last7d.length * 100).toFixed(2)
                : 0;

            const avgResponse = last24h.length > 0
                ? (last24h.reduce((sum, h) => sum + h.responseTime, 0) / last24h.length).toFixed(0)
                : 0;

            // Contar incidentes (mudanças de online para offline)
            let incidents = 0;
            for (let i = 1; i < last7d.length; i++) {
                if (last7d[i-1].status === 'online' && last7d[i].status !== 'online') {
                    incidents++;
                }
            }

            const currentStatus = siteHistory[siteHistory.length - 1]?.status || 'checking';

            return { uptime24h, uptime7d, avgResponse, totalIncidents: incidents, currentStatus };
        }

        const metrics = calculateMetrics();

        // Atualizar métricas na UI
        document.getElementById('uptime-24h').innerHTML = `${metrics.uptime24h}<span class="metric-unit">%</span>`;
        document.getElementById('uptime-7d').innerHTML = `${metrics.uptime7d}<span class="metric-unit">%</span>`;
        document.getElementById('avg-response').innerHTML = `${metrics.avgResponse}<span class="metric-unit">ms</span>`;
        document.getElementById('total-incidents').textContent = metrics.totalIncidents;

        const statusBadge = document.getElementById('site-status');
        statusBadge.className = `status-badge ${metrics.currentStatus}`;
        statusBadge.innerHTML = metrics.currentStatus === 'online' 
            ? '<i data-lucide="check-circle" style="display: inline-block; width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;"></i>Online'
            : '<i data-lucide="x-circle" style="display: inline-block; width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;"></i>Offline';

        // Gráfico de tempo de resposta
        const responseData = siteHistory.slice(-48).map(h => ({
            x: new Date(h.timestamp),
            y: h.responseTime
        }));

        new Chart(document.getElementById('responseChart'), {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Tempo de Resposta (ms)',
                    data: responseData,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'hour',
                            displayFormats: {
                                hour: 'HH:mm'
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Tempo (ms)'
                        }
                    }
                }
            }
        });

        // Gráfico de incidentes por dia
        const incidentsByDay = {};
        const now = Date.now();
        const day7 = now - (7 * 24 * 60 * 60 * 1000);
        const last7d = siteHistory.filter(h => new Date(h.timestamp).getTime() > day7);

        for (let i = 1; i < last7d.length; i++) {
            if (last7d[i-1].status === 'online' && last7d[i].status !== 'online') {
                const day = new Date(last7d[i].timestamp).toLocaleDateString('pt-BR');
                incidentsByDay[day] = (incidentsByDay[day] || 0) + 1;
            }
        }

        const incidentsLabels = Object.keys(incidentsByDay);
        const incidentsValues = Object.values(incidentsByDay);

        new Chart(document.getElementById('incidentsChart'), {
            type: 'bar',
            data: {
                labels: incidentsLabels,
                datasets: [{
                    label: 'Incidentes',
                    data: incidentsValues,
                    backgroundColor: '#ef4444',
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });

        // Timeline de incidentes
        const timelineContainer = document.getElementById('timeline-container');
        const incidents = [];

        for (let i = 1; i < siteHistory.length; i++) {
            if (siteHistory[i-1].status === 'online' && siteHistory[i].status !== 'online') {
                incidents.push({
                    type: 'incident',
                    timestamp: siteHistory[i].timestamp,
                    status: siteHistory[i].status
                });
            } else if (siteHistory[i-1].status !== 'online' && siteHistory[i].status === 'online') {
                incidents.push({
                    type: 'recovery',
                    timestamp: siteHistory[i].timestamp
                });
            }
        }

        if (incidents.length === 0) {
            timelineContainer.innerHTML = '<div class="no-data">Nenhum incidente registrado</div>';
        } else {
            incidents.reverse().slice(0, 20).forEach(incident => {
                const item = document.createElement('div');
                item.className = `timeline-item ${incident.type}`;
                
                const time = document.createElement('div');
                time.className = 'timeline-time';
                time.textContent = new Date(incident.timestamp).toLocaleString('pt-BR');
                
                const description = document.createElement('div');
                description.className = 'timeline-description';
                description.textContent = incident.type === 'incident' 
                    ? `Site ficou ${incident.status.toUpperCase()}`
                    : 'Site voltou ao normal (ONLINE)';
                
                item.appendChild(time);
                item.appendChild(description);
                timelineContainer.appendChild(item);
            });
        }

        lucide.createIcons();
    </script>
</body>
</html>
